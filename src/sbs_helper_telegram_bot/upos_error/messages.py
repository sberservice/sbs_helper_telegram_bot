"""
–°–æ–æ–±—â–µ–Ω–∏—è –º–æ–¥—É–ª—è –æ—à–∏–±–æ–∫ UPOS

–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –º–æ–¥—É–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫ UPOS.
–°–æ–æ–±—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ–æ—Ä–º–∞—Ç Telegram MarkdownV2 —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –Ω—É–∂–Ω–æ.
"""
# pylint: disable=line-too-long
# –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¥–≤–æ–π–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–ª—ç—à–∏ –Ω—É–∂–Ω—ã –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Telegram MarkdownV2

from typing import Optional
from datetime import datetime
import src.common.database as database

# ===== –°–û–û–ë–©–ï–ù–ò–Ø –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô =====

MESSAGE_SUBMENU = "üî¢ *UPOS –û—à–∏–±–∫–∏*\n\nüí° _–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é:_"


def _get_errors_count() -> int:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫ –∏–∑ –±–∞–∑—ã.

    Returns:
        –ß–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫.
    """
    try:
        with database.get_db_connection() as conn:
            with database.get_cursor(conn) as cursor:
                cursor.execute("""
                    SELECT COUNT(*) as cnt 
                    FROM upos_error_codes 
                    WHERE active = 1
                """)
                result = cursor.fetchone()
                if result:
                    return result['cnt']
    except Exception:
        pass
    return 0


def get_submenu_message() -> str:
    """
    –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–º–µ–Ω—é —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è MarkdownV2.
    """
    errors_count = _get_errors_count()
    return (
        "üî¢ *UPOS –û—à–∏–±–∫–∏*\n\n"
        f"üìä –í –±–∞–∑–µ: *{errors_count}* –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫"
        "\n\nüí° _–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é:_"
    )

MESSAGE_ENTER_ERROR_CODE = "üîç *–ü–æ–∏—Å–∫ –æ—à–∏–±–∫–∏*\n\n–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –æ—à–∏–±–∫–∏ UPOS \\(—á–∏—Å–ª–æ\\)\\.\n\n–î–ª—è –æ—Ç–º–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /cancel –∏–ª–∏ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É –º–µ–Ω—é\\."

MESSAGE_SEARCH_CANCELLED = "‚ùå –ü–æ–∏—Å–∫ –æ—Ç–º–µ–Ω—ë–Ω\\."

MESSAGE_ERROR_NOT_FOUND = "‚ùå *–ö–æ–¥ –æ—à–∏–±–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω*\n\n–ö–æ–¥ `{code}` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\\.\n\n–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ ‚Äî –º—ã –¥–æ–±–∞–≤–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–æ–π –æ—à–∏–±–∫–∏ –≤ –±—É–¥—É—â–µ–º\\."

MESSAGE_INVALID_ERROR_CODE = "‚ö†Ô∏è *–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥ –æ—à–∏–±–∫–∏*\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ–≤–æ–π –∫–æ–¥ –æ—à–∏–±–∫–∏ \\(–Ω–∞–ø—Ä–∏–º–µ—Ä: `101`, `2005`\\)\\."

MESSAGE_NO_POPULAR_ERRORS = "üìä *–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏*\n\n–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–ø—Ä–æ—Å–∞—Ö\\."

MESSAGE_POPULAR_ERRORS_HEADER = "üìä *–¢–æ–ø\\-{count} –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –æ—à–∏–±–æ–∫:*\n\n"


# ===== –°–û–û–ë–©–ï–ù–ò–Ø –î–õ–Ø –ê–î–ú–ò–ù–ê =====

MESSAGE_ADMIN_MENU = "üîê *–ê–¥–º–∏–Ω\\-–ø–∞–Ω–µ–ª—å UPOS –û—à–∏–±–∫–∏*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é:"

MESSAGE_ADMIN_NOT_AUTHORIZED = "‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\\."

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞–º–∏ –æ—à–∏–±–æ–∫
MESSAGE_ADMIN_ERRORS_LIST_EMPTY = "üìã *–°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ –ø—É—Å—Ç*\n\n–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –æ—à–∏–±–∫—É —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–∫–∏ ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É¬ª\\."

MESSAGE_ADMIN_ERRORS_LIST_HEADER = "üìã *–ö–æ–¥—ã –æ—à–∏–±–æ–∫ UPOS* \\(—Å—Ç—Ä\\. {page}/{total_pages}\\):\n\n"

MESSAGE_ADMIN_ENTER_ERROR_CODE = "‚ûï *–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏*\n\n–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –æ—à–∏–±–∫–∏ \\(—á–∏—Å–ª–æ –∏–ª–∏ —Ç–µ–∫—Å—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä: `101`, `E\\-001`\\):"

MESSAGE_ADMIN_SEARCH_ERROR_CODE = "üîç *–ü–æ–∏—Å–∫ –æ—à–∏–±–∫–∏*\n\n–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –æ—à–∏–±–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"

MESSAGE_ADMIN_ERROR_NOT_FOUND_FOR_EDIT = "‚ùå *–û—à–∏–±–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞*\n\n–ö–æ–¥ `{code}` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\\. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É¬ª –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è\\."

MESSAGE_ADMIN_ENTER_DESCRIPTION = "üìù *–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏*\n\n–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–æ–¥–∞ `{code}`:"

MESSAGE_ADMIN_ENTER_SUGGESTED_ACTIONS = "üí° *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏*\n\n–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –æ—à–∏–±–∫–∏ `{code}`:"

MESSAGE_ADMIN_SELECT_CATEGORY = "üìÅ *–ö–∞—Ç–µ–≥–æ—Ä–∏—è*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –æ—à–∏–±–∫–∏ `{code}` –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ:"

MESSAGE_ADMIN_ERROR_CREATED = "‚úÖ *–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞\\!*\n\n–ö–æ–¥: `{code}`\n–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category}\n–û–ø–∏—Å–∞–Ω–∏–µ: {description}"

MESSAGE_ADMIN_ERROR_EXISTS = "‚ö†Ô∏è –ö–æ–¥ –æ—à–∏–±–∫–∏ `{code}` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\\."

MESSAGE_ADMIN_ERROR_DELETED = "üóëÔ∏è –ö–æ–¥ –æ—à–∏–±–∫–∏ `{code}` —É–¥–∞–ª—ë–Ω\\."

MESSAGE_ADMIN_ERROR_DEACTIVATED = "üö´ –ö–æ–¥ –æ—à–∏–±–∫–∏ `{code}` –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω\\."

MESSAGE_ADMIN_ERROR_ACTIVATED = "‚úÖ –ö–æ–¥ –æ—à–∏–±–∫–∏ `{code}` –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω\\."

# –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
MESSAGE_ADMIN_EDIT_DESCRIPTION = "üìù *–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è*\n\n–¢–µ–∫—É—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:\n{current}\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:"

MESSAGE_ADMIN_EDIT_ACTIONS = "üí° *–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π*\n\n–¢–µ–∫—É—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n{current}\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"

MESSAGE_ADMIN_UPDATE_DATE_PROMPT = "üìÖ *–û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É?*\n\n–û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π?"

MESSAGE_ADMIN_ERROR_UPDATED = "‚úÖ *–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞\\!*"

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
MESSAGE_ADMIN_CATEGORIES_LIST_EMPTY = "üìÅ *–°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—É—Å—Ç*\n\n–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–∫–∏ ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é¬ª\\."

MESSAGE_ADMIN_CATEGORIES_LIST_HEADER = "üìÅ *–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ UPOS –æ—à–∏–±–æ–∫* \\(—Å—Ç—Ä\\. {page}/{total_pages}\\):\n\n"

MESSAGE_ADMIN_ENTER_CATEGORY_NAME = "‚ûï *–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏*\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:"

MESSAGE_ADMIN_ENTER_CATEGORY_DESCRIPTION = "üìù *–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏*\n\n–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´{name}¬ª \\(–∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ ¬´\\-¬ª –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞\\):"

MESSAGE_ADMIN_ENTER_CATEGORY_ORDER = "üî¢ *–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è*\n\n–í–≤–µ–¥–∏—Ç–µ –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´{name}¬ª \\(—á–∏—Å–ª–æ, –º–µ–Ω—å—à–µ \\= –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ\\):"

MESSAGE_ADMIN_CATEGORY_CREATED = "‚úÖ *–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞\\!*\n\n–ù–∞–∑–≤–∞–Ω–∏–µ: {name}"

MESSAGE_ADMIN_CATEGORY_EXISTS = "‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è ¬´{name}¬ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\\."

MESSAGE_ADMIN_CATEGORY_DELETED = "üóëÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è ¬´{name}¬ª —É–¥–∞–ª–µ–Ω–∞\\."

# –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–¥—ã
MESSAGE_ADMIN_UNKNOWN_CODES_EMPTY = "‚ùì *–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–¥—ã*\n\n–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º –∫–æ–¥–∞–º –æ—à–∏–±–æ–∫\\."

MESSAGE_ADMIN_UNKNOWN_CODES_HEADER = "‚ùì *–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–¥—ã* \\(—Å—Ç—Ä\\. {page}/{total_pages}\\):\n\n–ö–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –Ω–æ –∏—Ö –Ω–µ—Ç –≤ –±–∞–∑–µ:\n\n"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
MESSAGE_ADMIN_STATS = """üìà *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ UPOS –û—à–∏–±–∫–∏*

*–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:*
‚Ä¢ –ö–æ–¥–æ–≤ –æ—à–∏–±–æ–∫: {total_codes}
‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏–π: {total_categories}
‚Ä¢ –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤: {unknown_codes}

*–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:*
‚Ä¢ –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: {requests_7d}
‚Ä¢ –ù–∞–π–¥–µ–Ω–æ: {found_7d}
‚Ä¢ –ù–µ –Ω–∞–π–¥–µ–Ω–æ: {not_found_7d}

*–¢–æ–ø –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –∫–æ–¥–æ–≤:*
{top_codes}"""


# ===== –°–û–û–ë–©–ï–ù–ò–Ø –ò–ú–ü–û–†–¢–ê CSV =====

MESSAGE_ADMIN_CSV_IMPORT_START = """üì• *–ò–º–ø–æ—Ä—Ç –∏–∑ CSV*

–û—Ç–ø—Ä–∞–≤—å—Ç–µ CSV\\-—Ñ–∞–π–ª —Å –∫–æ–¥–∞–º–∏ –æ—à–∏–±–æ–∫\\.

*–¢—Ä–µ–±—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞:*
‚Ä¢ –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF\\-8 \\(—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è\\)
‚Ä¢ –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: –∑–∞–ø—è—Ç–∞—è \\(,\\) –∏–ª–∏ —Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π \\(;\\)
‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë

üí° *–°–æ–≤–µ—Ç –¥–ª—è Mac:* –í Numbers –≤—ã–±–µ—Ä–∏—Ç–µ –§–∞–π–ª ‚Üí –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ ‚Üí CSV, –∑–∞—Ç–µ–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É Unicode \\(UTF\\-8\\)\\.

*–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã:*
‚Ä¢ `error\\_code` –∏–ª–∏ `–∫–æ–¥` \\‚Äî –∫–æ–¥ –æ—à–∏–±–∫–∏
‚Ä¢ `description` –∏–ª–∏ `–æ–ø–∏—Å–∞–Ω–∏–µ` \\‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ
‚Ä¢ `suggested\\_actions` –∏–ª–∏ `—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏` \\‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

*–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã:*
‚Ä¢ `category` –∏–ª–∏ `–∫–∞—Ç–µ–≥–æ—Ä–∏—è` \\‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

*–ü—Ä–∏–º–µ—Ä CSV:*
`error\\_code,description,suggested\\_actions,category`
`101,–ù–µ—Ç –±—É–º–∞–≥–∏,–ó–∞–º–µ–Ω–∏—Ç—å —Ä—É–ª–æ–Ω,–ü—Ä–∏–Ω—Ç–µ—Ä`"""

MESSAGE_ADMIN_CSV_NO_FILE = "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ CSV\\-—Ñ–∞–π–ª\\."

MESSAGE_ADMIN_CSV_WRONG_FORMAT = "‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞\\. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º \\.csv\\."

MESSAGE_ADMIN_CSV_TOO_LARGE = "‚ö†Ô∏è –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π\\. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë\\."

MESSAGE_ADMIN_CSV_ENCODING_ERROR = "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª\\. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É \\(UTF\\-8 –∏–ª–∏ Windows\\-1251\\)\\."

MESSAGE_ADMIN_CSV_PARSE_ERRORS = """‚ùå *–û—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ CSV*

–ù–∞–π–¥–µ–Ω–æ –æ—à–∏–±–æ–∫: {error_count}

{errors}"""

MESSAGE_ADMIN_CSV_NO_RECORDS = "‚ö†Ô∏è –í —Ñ–∞–π–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏\\. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö\\."

MESSAGE_ADMIN_CSV_PREVIEW = """üìã *–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∞*

‚Ä¢ –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: *{total}*
‚Ä¢ –ù–æ–≤—ã—Ö –∫–æ–¥–æ–≤: *{new}*
‚Ä¢ –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç: *{existing}*
‚Ä¢ –û—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞: *{parse_errors}*

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é:"""

MESSAGE_ADMIN_CSV_CANCELLED = "‚ùå –ò–º–ø–æ—Ä—Ç –æ—Ç–º–µ–Ω—ë–Ω\\."

MESSAGE_ADMIN_CSV_IMPORT_RESULT = """‚úÖ *–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω\\!*

‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ: *{success}*
‚Ä¢ –ü—Ä–æ–ø—É—â–µ–Ω–æ \\(—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç\\): *{skipped}*
‚Ä¢ –û—à–∏–±–æ–∫: *{errors}*"""

MESSAGE_ADMIN_CSV_PROCESS_ERROR = "‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞\\: {error}"


# ===== –°–û–û–ë–©–ï–ù–ò–Ø –û–ë –û–®–ò–ë–ö–ê–• –†–ê–ó–ë–û–†–ê CSV =====

MESSAGE_CSV_ERROR_NO_CODE_COLUMN = "–ù–µ –Ω–∞–π–¥–µ–Ω —Å—Ç–æ–ª–±–µ—Ü —Å –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏. –û–∂–∏–¥–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è: error_code, –∫–æ–¥, –∫–æ–¥_–æ—à–∏–±–∫–∏, code"
MESSAGE_CSV_ERROR_NO_DESC_COLUMN = "–ù–µ –Ω–∞–π–¥–µ–Ω —Å—Ç–æ–ª–±–µ—Ü —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º. –û–∂–∏–¥–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è: description, –æ–ø–∏—Å–∞–Ω–∏–µ, desc"
MESSAGE_CSV_ERROR_NO_ACTIONS_COLUMN = "–ù–µ –Ω–∞–π–¥–µ–Ω —Å—Ç–æ–ª–±–µ—Ü —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏. –û–∂–∏–¥–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è: suggested_actions, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, actions"
MESSAGE_CSV_ERROR_EMPTY_CODE = "–°—Ç—Ä–æ–∫–∞ {row}: –ø—É—Å—Ç–æ–π –∫–æ–¥ –æ—à–∏–±–∫–∏"
MESSAGE_CSV_ERROR_CODE_TOO_LONG = "–°—Ç—Ä–æ–∫–∞ {row}: –∫–æ–¥ –æ—à–∏–±–∫–∏ '{code}...' —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (–º–∞–∫—Å. 50 —Å–∏–º–≤–æ–ª–æ–≤)"
MESSAGE_CSV_ERROR_EMPTY_DESC = "–°—Ç—Ä–æ–∫–∞ {row}: –ø—É—Å—Ç–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–æ–¥–∞ '{code}'"
MESSAGE_CSV_ERROR_EMPTY_ACTIONS = "–°—Ç—Ä–æ–∫–∞ {row}: –ø—É—Å—Ç—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫–æ–¥–∞ '{code}'"
MESSAGE_CSV_ERROR_ROW_PROCESSING = "–°—Ç—Ä–æ–∫–∞ {row}: –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ - {error}"
MESSAGE_CSV_ERROR_PARSE = "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV: {error}"
MESSAGE_CSV_ERROR_UNEXPECTED = "–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {error}"
MESSAGE_CSV_ERROR_IMPORT = "–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ '{code}': {error}"


# ===== –û–ë–©–ò–ï UI-–°–û–û–ë–©–ï–ù–ò–Ø =====

MESSAGE_SELECT_ACTION = "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é:"
MESSAGE_NO_CATEGORY = "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
MESSAGE_NO_DATA = "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
MESSAGE_USE_LIST_BUTTON = "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É ¬´üìã –°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫¬ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞."
MESSAGE_NO_IMPORT_DATA = "‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞\\."
MESSAGE_IMPORT_IN_PROGRESS = "‚è≥ *–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö\\.\\.\\.*\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ\\."
MESSAGE_AND_MORE = "\\.\\.\\. –∏ –µ—â—ë {count}"


# ===== –ü–û–î–ü–ò–°–ò –ö–ù–û–ü–û–ö –ö–õ–ê–í–ò–ê–¢–£–†–´ =====

BUTTON_FORWARD = "–í–ø–µ—Ä—ë–¥ ‚û°Ô∏è"
BUTTON_BACK = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
BUTTON_BACK_TO_MENU = "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"


# ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

def escape_markdown_v2(text: str) -> str:
    """
    –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è Telegram MarkdownV2.

    –°–Ω–∞—á–∞–ª–∞ —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–ª—ç—à–∏, –∑–∞—Ç–µ–º —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã.

    Args:
        text: –¢–µ–∫—Å—Ç –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

    Returns:
        –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
    """
    if not text:
        return ""
    # –°–Ω–∞—á–∞–ª–∞ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–ª—ç—à–∏
    text = text.replace('\\', '\\\\')
    special_chars = ['_', '*', '[', ']', '(', ')', '~', '`', '>', '#', '+', '-', '=', '|', '{', '}', '.', '!']
    for char in special_chars:
        text = text.replace(char, f'\\{char}')
    return text


def format_error_code_response(
    error_code: str,
    description: str,
    suggested_actions: str,
    category_name: Optional[str] = None,
    updated_timestamp: Optional[int] = None
) -> str:
    """
    –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–¥–µ –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

    Args:
        error_code: –ö–æ–¥ –æ—à–∏–±–∫–∏.
        description: –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏.
        suggested_actions: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é.
        category_name: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
        updated_timestamp: Unix-–≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ MarkdownV2.
    """
    escaped_code = escape_markdown_v2(error_code)
    escaped_desc = escape_markdown_v2(description)
    escaped_actions = escape_markdown_v2(suggested_actions)
    
    parts = [f"üî¢ *–ö–æ–¥ –æ—à–∏–±–∫–∏:* `{escaped_code}`\n"]
    
    if category_name:
        escaped_category = escape_markdown_v2(category_name)
        parts.append(f"üìÅ *–ö–∞—Ç–µ–≥–æ—Ä–∏—è:* {escaped_category}\n")
    
    parts.append(f"\nüìã *–û–ø–∏—Å–∞–Ω–∏–µ:*\n{escaped_desc}\n")
    parts.append(f"\nüí° *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n{escaped_actions}")
    
    if updated_timestamp:
        date_str = datetime.fromtimestamp(updated_timestamp).strftime('%d.%m.%Y')
        escaped_date = escape_markdown_v2(date_str)
        parts.append(f"\n\nüìÖ _–û–±–Ω–æ–≤–ª–µ–Ω–æ: {escaped_date}_")
    
    return "".join(parts)


def format_error_list_item(
    error_code: str,
    description: str,
    category_name: Optional[str] = None,
    times_requested: int = 0
) -> str:
    """
    –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –æ—à–∏–±–∫–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ (–∞–¥–º–∏–Ω).

    Args:
        error_code: –ö–æ–¥ –æ—à–∏–±–∫–∏.
        description: –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞–Ω–æ).
        category_name: –ö–∞—Ç–µ–≥–æ—Ä–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
        times_requested: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö).

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–ø–∏—Å–∫–∞.
    """
    escaped_code = escape_markdown_v2(error_code)
    
    # –û–±—Ä–µ–∑–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤
    short_desc = description[:50] + "..." if len(description) > 50 else description
    escaped_desc = escape_markdown_v2(short_desc)
    
    if times_requested > 0:
        return f"‚Ä¢ `{escaped_code}` \\({times_requested}x\\) \\- {escaped_desc}"
    elif category_name:
        escaped_cat = escape_markdown_v2(category_name)
        return f"‚Ä¢ `{escaped_code}` \\[{escaped_cat}\\] \\- {escaped_desc}"
    else:
        return f"‚Ä¢ `{escaped_code}` \\- {escaped_desc}"


def format_unknown_code_item(error_code: str, times_requested: int, last_timestamp: int) -> str:
    """
    –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–¥ –¥–ª—è —Å–ø–∏—Å–∫–∞.

    Args:
        error_code: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–¥ –æ—à–∏–±–∫–∏.
        times_requested: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤.
        last_timestamp: –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–ø–∏—Å–∫–∞.
    """
    escaped_code = escape_markdown_v2(error_code)
    date_str = datetime.fromtimestamp(last_timestamp).strftime('%d.%m.%Y')
    escaped_date = escape_markdown_v2(date_str)
    
    return f"‚Ä¢ `{escaped_code}` \\- {times_requested}x \\(–ø–æ—Å–ª–µ–¥–Ω–∏–π: {escaped_date}\\)"


def format_category_list_item(name: str, error_count: int, display_order: int = 0) -> str:
    """
    –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —Å–ø–∏—Å–∫–∞.

    Args:
        name: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
        error_count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
        display_order: –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ API).

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–ø–∏—Å–∫–∞.
    """
    _ = display_order  # –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ API
    escaped_name = escape_markdown_v2(name)
    return f"‚Ä¢ {escaped_name} \\({error_count} –æ—à–∏–±–æ–∫\\)"
